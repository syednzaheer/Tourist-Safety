<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Police Dashboard | Smart Safety</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <!-- Premium Styles -->
  <link href="css/style.css" rel="stylesheet">
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar navbar-glass fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">‚¨Ö Back to Home</a>
    </div>
  </nav>

  <div class="container" style="margin-top: 100px;">

    <!-- Header -->
    <div class="hero-card p-4 text-start mb-4 d-flex justify-content-between align-items-center flex-wrap">
      <div>
        <h2 class="mb-1 fw-bold">üëÆ‚Äç‚ôÇÔ∏è Police Dashboard</h2>
        <p class="mb-0 text-white-50">Real-time incident monitoring & SOS alerts.</p>
      </div>
      <div class="text-end mt-3 mt-md-0">
        <span class="badge bg-danger p-2 fs-6">Live System</span>
      </div>
    </div>

    <!-- INCIDENT REPORTS -->
    <div class="content-card mt-0">
      <h4 class="mb-4" style="color: var(--navy-800);">Incident Reports</h4>
      <div class="table-responsive">
        <table class="table-glass">
          <thead>
            <tr>
              <th>Location</th>
              <th>Issue</th>
              <th>Description</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="allReports"></tbody>
        </table>
      </div>
    </div>

    <!-- SOS ALERTS -->
    <div class="content-card">
      <h4 class="mb-4 text-danger">üö® Live SOS Feed</h4>
      <ul id="sosAlerts" class="list-group"></ul>
    </div>

  </div>

  <script src="js/app.js"></script>
  <script>
    // Pull reports
    const reports = JSON.parse(localStorage.getItem("reports") || "[]");
    const tableBody = document.getElementById("allReports");

    if (reports.length === 0) {
      tableBody.innerHTML = "<tr><td colspan='4' class='text-center text-muted p-4'>No incidents reported yet.</td></tr>";
    }

    reports.forEach(r => {
      const pillClass =
        r.status === "Open" ? "status-open" :
          r.status === "In Progress" ? "status-progress" :
            "status-resolved";

      tableBody.innerHTML += `
        <tr>
          <td><span class="fw-bold text-dark">${r.loc}</span></td>
          <td>${r.issue}</td>
          <td class="text-muted small">${r.desc}</td>
          <td><span class="status-pill ${pillClass}">${r.status}</span></td>
        </tr>
      `;
    });

    // Pull SOS Alerts & Global Alerts
    const sos = JSON.parse(localStorage.getItem("sosAlerts") || "[]");
    const globalAlerts = JSON.parse(localStorage.getItem("alerts") || "[]");

    const sosList = document.getElementById("sosAlerts");

    // Merge logic for demo
    const allSos = [...globalAlerts, ...sos].slice(0, 10); // Show last 10

    if (allSos.length === 0) {
      sosList.innerHTML = "<li class='list-group-item text-center text-muted'>No SOS alerts in the system.</li>";
    }

    allSos.forEach(alert => {
      // Handle both formats (string or object)
      let text = typeof alert === 'string' ? alert : (alert.note || alert.type);
      let time = alert.time ? new Date(alert.time).toLocaleTimeString() : '';

      sosList.innerHTML += `
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
             <span class="fw-bold text-danger me-2">SOS</span>
             <span>${text}</span>
          </div>
          <small class="text-muted">${time}</small>
        </li>
      `;
    });
  </script>
</body>

</html>